<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="img/favicon.ico">

<title>simpleCert Registrierung</title>

<!-- Bootstrap core CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="css/register.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="intern/dist/css/sb-admin-2.css" rel="stylesheet">

<!-- Custom Fonts -->
<link
	href="intern/bower_components/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">


<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<style>
.container {
	margin: 40px auto;
	max-width: 600px;
	height: auto;
	background-color: #F9F9F9;
	text-align: center;
}

.btn-red {
	color: #fff;
	background-color: #C03A2A;
	border-color: #A83A2A;
	margin: 20px auto 10px auto;
	outline: none;
	width: 50%;
	margin-bottom: 25px;
}

.btn-red:hover, .btn-red:focus {
	color: #fff;
	background-color: #A83A2A;
	border-color: #A83A2A;
	outline: none;
	transition: background-color .4s ease;
}

.btn-primary {
	color: #000;
	background-color: #C8C8C8;
	border-color: #C8C8C8;
}

.btn-small {
	width: 320px;
}

.messagebar_placeholder {
	position: relative;
	top: -40px;
	height: 55px;
}

.messagebar {
	position: relative;
	height: 55px;
	bottom: 55px;	
	border-radius: 0px;
	padding: 0;
	margin: 0;
	border: 0;
	transition: bottom .4s ease;
	line-height: 55px;
	border-radius: 0px;
}

.messageicon {
	outline: none;
	margin-left: 15px;
	margin-right: 10px;
}

.messagebar_down {
	bottom: 0;
}
</style>
<head>


</head>

<body id="body" style="background-color: white">
	<div class="messagebar_placeholder">
		<div id="messagebar" style="cursor: context-menu;"
			class="alert messagebar"></div>
	</div>
	<div class="container">
		<img src="img/logo_text.png" style="width: 140px; margin-top: 20px;" /><br />
		<h3 style="color: #595959">Eröffnen Sie Ihren simpleCert-Account.</h3>
		<br />
		<form name="form_register" action="RegisterServlet" method="post">
			<div class="form-group col-lg-6">
				<input type="text" name="firstName" class="form-control"
					id="firstName" onchange="checkInputField('firstName')"
					placeholder="Vorname" required>
			</div>
			<div class="form-group col-lg-6">
				<input type="text" name="lastName" class="form-control"
					id="lastName" onchange="checkInputField('lastName')"
					placeholder="Nachname" required>
			</div>
			<div class="form-group col-lg-6">

				<!--<div class="form-group"> -->
				<select class="form-control" id="organizationalUnit"
					name="organizationalUnit" onchange="checkInputField('organizationalUnit')" required>
					<option value="" selected disabled>Abteilung</option>
					<option>IT</option>
					<option>Verwaltung</option>
					<option>Vertrieb</option>
				</select>

			</div>
			<div class="form-group col-lg-6">
				<input type="number" name="personalId" id="personalId"
					class="form-control" onchange="checkInputField('personalId')"
					placeholder="Personalnummer" required>
			</div>

			<div class="clearfix"></div>
			<div class="form-group col-lg-6">
				<input type="email" name="emailAddress" class="form-control"
					id="emailAddress" onchange="checkInputField('emailAddress')"
					placeholder="E-Mail-Adresse" required>
			</div>

			<div class="form-group col-lg-6">
				<input type="email" class="form-control" onpaste="return false;"
					id="emailAddress_confirm" placeholder="E-Mail-Adresse wiederholen"
					onchange="compareInputField('emailAddress')" required>
			</div>

			<div class="form-group col-lg-6">
				<input type="password" name="password" class="form-control" 
					id="password" onchange="checkInputField('password')"
					placeholder="Passwort" required>
			</div>
			<div class="form-group col-lg-6">
				<input type="password" class="form-control" onpaste="return false;"
					id="password_confirm" placeholder="Passwort wiederholen"
					onchange="compareInputField('password')" required>
			</div>

			<script type="text/javascript">
			var messageRegistry = [];
			
				function checkInputField(type) {
					var inputField = document.getElementById(type)
					if (inputField.value !== "" && !inputField.checkValidity()) {
						inputField.classList.remove("has-warning")
						inputField.classList.add("has-error")
						showMessageBar(type, "check")
					} else if (inputField.value !== ""
							&& inputField.checkValidity()) {
						hideMessageBar()
						inputField.classList.remove("has-warning")
						inputField.classList.remove("has-error")						
						
						// TODO: DB query if emailAddress/personalId already exists
						
					} else if (inputField.value === "") {
						hideMessageBar()
						inputField.classList.remove("has-error")
					}
				}

				// Method which checks email and password confirmation and gives feedback to the user
				function compareInputField(type) {
					var inputValue, inputValueConfirm, inputConfirmField
					inputValue = document.getElementById(type).value
					inputValueConfirm = document.getElementById(type
							+ '_confirm').value
					inputConfirmField = document.getElementById(type
							+ '_confirm')

					// Compare field values and add style classes according to the result
					if (inputValueConfirm !== "") {
						if (inputValue !== inputValueConfirm) {
							inputConfirmField.classList.remove("has-warning")
							inputConfirmField.classList.add("has-error")
							showMessageBar(type, "compare")
							return false;
						} else {
							inputConfirmField.classList.remove("has-warning")
							inputConfirmField.classList.remove("has-error")
							hideMessageBar()
							return true;
						}
					} else {
						inputConfirmField.classList.remove("has-warning")
						inputConfirmField.classList.remove("has-error")
						hideMessageBar()
					}
				}

				// Method which checks all field values before submitting them to the backend and gives feedback to the user				
				function checkFormBeforeSubmit() {
					var inputFields = [], messagebar, invalidField = false, emptyField = false;
					// Get all field values
					inputFields[0] = document.getElementById('firstName')
					inputFields[1] = document.getElementById('lastName')
					inputFields[2] = document
							.getElementById('organizationalUnit')
					inputFields[3] = document.getElementById('personalId')
					inputFields[4] = document.getElementById('emailAddress')
					inputFields[5] = document
							.getElementById('emailAddress_confirm')
					inputFields[6] = document.getElementById('password')
					inputFields[7] = document
							.getElementById('password_confirm')
					messagebar = document.getElementById('messagebar')

					// All fields have to be filled
					for (var i = 0; i < inputFields.length; i++) {
						if (inputFields[i].value === "") {
							emptyField = true;
							inputFields[i].classList.add("has-warning")
						}
					}
					if (!emptyField) {
						hideMessageBar()
						if (compareInputField("emailAddress")
								&& compareInputField("password")) {
							form_register.submit()
						}

					} else {
						showMessageBar("emptyField")
					}
				}

				function showMessageBar(type, kindOfCheck) {
					var message, messagebar = document
							.getElementById('messagebar'), messagebarContent = '<div class="btn btn-default btn-circle messageicon" style="cursor: context-menu; border-color:'
					if (type !== "emptyField") {
						if (type === "firstName" || type === "lastName") {
							message = "Der "
									+ document.getElementById(type).placeholder
									+ " darf nur Buchstaben enthalten"
						} else if (type === "personalId") {
							message = "Die "
									+ document.getElementById(type).placeholder
									+ " darf nur Ziffern enthalten"

						} else if (type === "emailAddress") {
							if (kindOfCheck === "check") {
								message = "Die "
										+ document.getElementById(type).placeholder
										+ " muss ein '@' enthalten (Beispiel: max.mustermann@simplecert.de)"
							} else if (kindOfCheck === "compare") {
								message = "Die wiederholte E-Mail-Adresse stimmt nicht mit der E-Mail-Adresse überein!"
							}
						} else if (type === "password") {
							message = "Das wiederholte Passwort stimmt nicht mit dem Passwort überein!"
						}
						messagebarContent = messagebarContent
								+ '#843534;"> <i id="messagebar_icon" style="color: #d9534f;" class="fa fa-times"></i> </div>'
								+ message
						if (messagebar.style.bottom !== 0) {
							messagebar.innerHTML = messagebarContent;
							messagebar.classList.remove("alert-warning")
							messagebar.classList.add("alert-danger")
						}
					} else {
						message = "Bitte füllen Sie alle Felder aus!"
						messagebarContent = messagebarContent
								+ ' #66512c;"> <i id="messagebar_icon" style="color: #f0ad4e;" class="fa fa-exclamation"></i> </div>'
								+ message
						if (messagebar.style.bottom !== 0) {
							messagebar.innerHTML = messagebarContent;
							messagebar.classList.remove("alert-danger")
							messagebar.classList.add("alert-warning")
						}
					}
					// SlideDown
					messagebar.style.bottom = 0

				}
				function hideMessageBar() {	
					// SlideUp
					messagebar.style.bottom = "55px"
					messagebar.innerHTML = "";
				}
			</script>

			<button type="button" class="btn btn-lg btn-red btn-block"
				onclick="checkFormBeforeSubmit()">Absenden</button>
		</form>
		<br />
	</div>
	<!-- End container -->
</body>
</html>
